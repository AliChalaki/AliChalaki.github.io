<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم مدیریت اموال سازمان</title>
    <style>
        @font-face {
            font-family: 'IRANSans';
            src: url('https://cdn.fontcdn.ir/Font/Persian/IRANSans/IRANSansWeb(FaNum).woff') format('woff');
        }
        
        :root {
            --primary-color: #1a5276;
            --secondary-color: #2c3e50;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --header-bg: #1a5276;
            --header2-bg: #1a5276;
            --header2-text: #ffffff;
            --sidebar-bg: #2c3e50;
            --table-header-bg: #f2f2f2;
            --table-row-even: #f9f9f9;
            --success-bg: #d4edda;
            --success-text: #155724;
            --error-bg: #f8d7da;
            --error-text: #721c24;
            --button-icon-color: #ffffff;
        }
        
        .dark-mode {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --text-color: #ecf0f1;
            --bg-color: #34495e;
            --header-bg: #2c3e50;
            --header2-bg: #2c3e50;
            --sidebar-bg: #1a252f;
            --table-header-bg: #2c3e50;
            --table-row-even: #3d5166;
            --success-bg: #145a32;
            --success-text: #d5f5e3;
            --error-bg: #7b241c;
            --error-text: #fadbd8;
            --button-icon-color: #ffffff;
        }
        
        body {
            font-family: 'IRANSans', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .header-container {
            display: flex;
            flex-direction: column;
        }
        
        .header1 {
            background-color: var(--header-bg);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .header2 {
            background-color: var(--header2-bg);
            color: var(--header2-text);
            padding: 12px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .bismillah {
            text-align: center;
            font-size: 18px;
            padding: 5px;
            margin-bottom: 5px;
        }
        
        .system-title {
            text-align: center;
            font-size: 20px;
            margin: 5px 0;
        }
        
        .header-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 5px;
            font-size: 14px;
        }
        
        .logo {
            height: 50px;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .welcome-message {
            font-weight: bold;
            font-size: 16px;
        }
        
        .container {
            display: flex;
            min-height: calc(100vh - 180px);
        }
        
        .sidebar {
            width: 250px;
            background-color: var(--sidebar-bg);
            color: white;
            padding: 20px;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            background-color: white;
        }
        
        .dark-mode .main-content {
            background-color: #2c3e50;
        }
        
        .menu-item {
            padding: 10px;
            margin: 5px 0;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .menu-item:hover {
            background-color: #34495e;
        }
        
        .menu-item.active {
            background-color: var(--primary-color);
        }
        
        .menu-icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: white;
            color: #333;
        }
        
        .dark-mode input, .dark-mode select {
            background-color: #34495e;
            color: white;
            border-color: #1a252f;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background-color: #154360;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        
        .dark-mode th, .dark-mode td {
            border-color: #1a252f;
        }
        
        th {
            background-color: var(--table-header-bg);
        }
        
        tr:nth-child(even) {
            background-color: var(--table-row-even);
        }
        
        .action-buttons-cell {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .action-button {
            padding: 6px 12px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .edit-button {
            background-color: #ffc107;
            color: #000;
        }
        
        .delete-button {
            background-color: #dc3545;
            color: white;
        }
        
        .search-container {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .dark-mode .search-container {
            background-color: #3d5166;
        }
        
        .search-fields {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .search-field {
            flex: 1;
            min-width: 200px;
        }
        
        .report-section {
            margin-top: 30px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .dark-mode .report-section {
            background-color: #3d5166;
        }
        
        .report-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }
        
        .stat-box {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .dark-mode .stat-box {
            background-color: #34495e;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 5px;
        }
        
        .hidden {
            display: none;
        }
        
        .success-message {
            background-color: var(--success-bg);
            color: var(--success-text);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            display: none;
        }
        
        .error-message {
            background-color: var(--error-bg);
            color: var(--error-text);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            display: none;
        }
        
        .dark-mode-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .dark-mode-toggle:hover {
            transform: scale(1.1);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 5px;
            width: 80%;
            max-width: 500px;
        }
        
        .dark-mode .modal-content {
            background-color: #2c3e50;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .about-section {
            line-height: 1.6;
            padding: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .action-icon {
            width: 16px;
            height: 16px;
            fill: var(--button-icon-color);
        }
        
        .button-icon {
            width: 18px;
            height: 18px;
            fill: var(--button-icon-color);
        }
    </style>
</head>
<body>
    <div class="header-container">
        <div class="header1">
            <img src="Logo.png" alt="لوگوی سازمان" class="logo">
            <div class="bismillah">بسمه تعالی</div>
            <div class="system-title">سیستم مدیریت اموال سازمان</div>
            <div class="header-info">
                <div class="header-date" id="dateTime"></div>
                <div class="header-weekday" id="currentWeekday"></div>
            </div>
        </div>
        
        <div class="header2">
            <div class="welcome-message" id="welcomeMessage">وقت بخیر علی</div>
        </div>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <div class="menu-item active" onclick="showSection('add-asset')">
                <svg class="menu-icon" viewBox="0 0 24 24">
                    <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
                </svg>
                ثبت اموال جدید
            </div>
            <div class="menu-item" onclick="showSection('view-assets')">
                <svg class="menu-icon" viewBox="0 0 24 24">
                    <path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" />
                </svg>
                مشاهده اموال
            </div>
            <div class="menu-item" onclick="showSection('search-assets')">
                <svg class="menu-icon" viewBox="0 0 24 24">
                    <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
                </svg>
                جستجوی اموال
            </div>
            <div class="menu-item" onclick="showSection('reports')">
                <svg class="menu-icon" viewBox="0 0 24 24">
                    <path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19M13,17H11V7H13V17M15,13H17V7H15V13M7,17H9V7H7V17Z" />
                </svg>
                گزارشات
            </div>
            <div class="menu-item" onclick="exportToExcel()">
                <svg class="menu-icon" viewBox="0 0 24 24">
                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                </svg>
                خروجی اکسل
            </div>
            <div class="menu-item" onclick="importFromExcel()">
                <svg class="menu-icon" viewBox="0 0 24 24">
                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                </svg>
                ورودی اکسل
            </div>
            <div class="menu-item" onclick="manageLocations()">
                <svg class="menu-icon" viewBox="0 0 24 24">
                    <path d="M12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5M12,2A7,7 0 0,1 19,9C19,14.25 12,22 12,22C12,22 5,14.25 5,9A7,7 0 0,1 12,2M12,4A5,5 0 0,0 7,9C7,10 7,12 12,18.71C17,12 17,10 17,9A5,5 0 0,0 12,4Z" />
                </svg>
                مدیریت محل‌های استقرار
            </div>
            <div class="menu-item" onclick="changeResponsible()">
                <svg class="menu-icon" viewBox="0 0 24 24">
                    <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" />
                </svg>
                تغییر مسئول اموال
            </div>
            <div class="menu-item" onclick="showSection('about')">
                <svg class="menu-icon" viewBox="0 0 24 24">
                    <path d="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" />
                </svg>
                درباره برنامه
            </div>
        </div>
        
        <div class="main-content">
            <div id="add-asset" class="section">
                <h3>ثبت اموال جدید</h3>
                <div class="success-message" id="addSuccess"></div>
                <div class="error-message" id="addError"></div>
                
                <div class="form-group">
                    <label for="asset-name">نام کالا/اموال:</label>
                    <input type="text" id="asset-name" required>
                </div>
                
                <div class="form-group">
                    <label for="asset-code">کد اموال:</label>
                    <input type="text" id="asset-code" required>
                </div>
                
                <div class="form-group">
                    <label for="person-name">نام فرد:</label>
                    <input type="text" id="person-name" required>
                </div>
                
                <div class="form-group">
                    <label for="person-code">کد اختصاصی فرد:</label>
                    <input type="text" id="person-code">
                </div>
                
                <div class="form-group">
                    <label for="asset-location">محل استقرار:</label>
                    <select id="asset-location" required>
                        <option value="">انتخاب کنید</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="asset-responsible">مسئول ثبت اموال:</label>
                    <input type="text" id="asset-responsible" required>
                </div>
                
                <div class="action-buttons">
                    <button onclick="addAsset()">
                        <svg class="button-icon" viewBox="0 0 24 24">
                            <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
                        </svg>
                        ثبت اموال
                    </button>
                    <button onclick="clearForm()" style="background-color: #6c757d;">
                        <svg class="button-icon" viewBox="0 0 24 24">
                            <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                        </svg>
                        پاک کردن فرم
                    </button>
                </div>
            </div>
            
            <div id="view-assets" class="section hidden">
                <h3>لیست اموال سازمان</h3>
                <table id="assets-table">
                    <thead>
                        <tr>
                            <th>ردیف</th>
                            <th>نام کالا</th>
                            <th>کد اموال</th>
                            <th>نام فرد</th>
                            <th>کد فرد</th>
                            <th>محل استقرار</th>
                            <th>مسئول ثبت</th>
                            <th>تاریخ ثبت</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>
                    <tbody id="assets-list">
                        <!-- Assets will be added here dynamically -->
                    </tbody>
                </table>
            </div>
            
            <div id="search-assets" class="section hidden">
                <h3>جستجوی اموال</h3>
                <div class="search-container">
                    <div class="search-fields">
                        <div class="search-field">
                            <label for="search-asset-code">جستجو با کد اموال:</label>
                            <input type="text" id="search-asset-code" placeholder="کد اموال">
                        </div>
                        <div class="search-field">
                            <label for="search-person-name">جستجو با نام فرد:</label>
                            <input type="text" id="search-person-name" placeholder="نام فرد">
                        </div>
                        <div class="search-field">
                            <label for="search-person-code">جستجو با کد فرد:</label>
                            <input type="text" id="search-person-code" placeholder="کد فرد">
                        </div>
                    </div>
                    <button onclick="searchAssets()" style="margin-top: 15px;">
                        <svg class="button-icon" viewBox="0 0 24 24">
                            <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
                        </svg>
                        جستجو
                    </button>
                    <button onclick="clearSearch()" style="margin-top: 15px; background-color: #6c757d;">
                        <svg class="button-icon" viewBox="0 0 24 24">
                            <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                        </svg>
                        پاک کردن
                    </button>
                </div>
                
                <table id="search-results-table">
                    <thead>
                        <tr>
                            <th>ردیف</th>
                            <th>نام کالا</th>
                            <th>کد اموال</th>
                            <th>نام فرد</th>
                            <th>کد فرد</th>
                            <th>محل استقرار</th>
                            <th>مسئول ثبت</th>
                            <th>تاریخ ثبت</th>
                        </tr>
                    </thead>
                    <tbody id="search-results">
                        <!-- Search results will be added here dynamically -->
                    </tbody>
                </table>
            </div>
            
            <div id="reports" class="section hidden">
                <h3>گزارشات سیستم</h3>
                <div class="report-section">
                    <h4>آمار کلی</h4>
                    <div class="report-stats">
                        <div class="stat-box">
                            <div>تعداد کل اموال</div>
                            <div class="stat-value" id="total-assets">0</div>
                        </div>
                        <div class="stat-box">
                            <div>تعداد محل‌های استقرار</div>
                            <div class="stat-value" id="total-locations">0</div>
                        </div>
                        <div class="stat-box">
                            <div>مسئول فعلی اموال</div>
                            <div class="stat-value" id="current-responsible">-</div>
                        </div>
                        <div class="stat-box">
                            <div>آخرین تغییرات</div>
                            <div class="stat-value" id="last-update">-</div>
                        </div>
                    </div>
                </div>
                
                <div class="report-section" style="margin-top: 20px;">
                    <h4>توزیع اموال بر اساس محل استقرار</h4>
                    <table id="location-distribution">
                        <thead>
                            <tr>
                                <th>محل استقرار</th>
                                <th>تعداد اموال</th>
                                <th>درصد</th>
                            </tr>
                        </thead>
                        <tbody id="location-distribution-body">
                            <!-- Distribution data will be added here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div id="manage-locations" class="section hidden">
                <h3>مدیریت محل‌های استقرار</h3>
                <div class="success-message" id="locationSuccess"></div>
                <div class="error-message" id="locationError"></div>
                
                <div class="form-group">
                    <label for="new-location">افزودن محل استقرار جدید:</label>
                    <input type="text" id="new-location" placeholder="نام محل استقرار (مثلاً اتاق1)">
                </div>
                <button onclick="addLocation()">
                    <svg class="button-icon" viewBox="0 0 24 24">
                        <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
                    </svg>
                    افزودن محل
                </button>
                
                <h4 style="margin-top: 30px;">لیست محل‌های استقرار</h4>
                <table id="locations-table">
                    <thead>
                        <tr>
                            <th>ردیف</th>
                            <th>نام محل</th>
                            <th>تعداد اموال</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>
                    <tbody id="locations-list">
                        <!-- Locations will be added here dynamically -->
                    </tbody>
                </table>
            </div>
            
            <div id="change-responsible" class="section hidden">
                <h3>تغییر مسئول اموال</h3>
                <div class="success-message" id="responsibleSuccess"></div>
                <div class="error-message" id="responsibleError"></div>
                
                <div class="form-group">
                    <label for="new-responsible">نام مسئول جدید:</label>
                    <input type="text" id="new-responsible" required>
                </div>
                
                <button onclick="changeResponsiblePerson()">
                    <svg class="button-icon" viewBox="0 0 24 24">
                        <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z" />
                    </svg>
                    تغییر مسئول
                </button>
            </div>
            
            <div id="about" class="section hidden">
                <h3>درباره برنامه</h3>
                <div class="about-section">
                    <p>این برنامه توسط علی چالاکی طراحی و توسعه داده شده است.</p>
                    <p>سیستم مدیریت اموال سازمان یک راهکار جامع برای ثبت، پیگیری و مدیریت اموال و دارایی‌های سازمانی می‌باشد.</p>
                    <p>ویژگی‌های اصلی:</p>
                    <ul>
                        <li>ثبت اموال با جزئیات کامل</li>
                        <li>مدیریت محل‌های استقرار</li>
                        <li>جستجوی پیشرفته اموال</li>
                        <li>گزارشات تحلیلی</li>
                        <li>خروجی اکسل با تاریخ شمسی</li>
                        <li>ورود اطلاعات از اکسل</li>
                    </ul>
                    <p>برای پشتیبانی و اطلاعات بیشتر با شماره زیر تماس بگیرید:</p>
                    <p style="font-weight: bold; font-size: 18px;">09102655884</p>
                </div>
            </div>
        </div>
    </div>

    <button class="dark-mode-toggle" onclick="toggleDarkMode()" id="darkModeToggle">💡</button>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3 id="confirmTitle">تایید عملیات</h3>
            <p id="confirmMessage">آیا از انجام این عملیات مطمئن هستید؟</p>
            <div class="modal-buttons">
                <button onclick="confirmAction(true)" style="background-color: #dc3545;">بله</button>
                <button onclick="confirmAction(false)">خیر</button>
            </div>
        </div>
    </div>

    <div id="responsibleModal" class="modal">
        <div class="modal-content">
            <h3>ثبت مسئول اموال</h3>
            <p>لطفاً نام مسئول اموال را وارد کنید (این عمل فقط در اولین ورود انجام می‌شود):</p>
            <input type="text" id="initial-responsible" style="width: 100%; padding: 8px; margin: 10px 0;">
            <div class="modal-buttons">
                <button onclick="setInitialResponsible()">ثبت</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for Excel import -->
    <input type="file" id="excelFileInput" class="file-input" accept=".xlsx, .xls">

    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script>
        // Initialize data
        let assets = JSON.parse(localStorage.getItem('assets')) || [];
        let locations = JSON.parse(localStorage.getItem('locations')) || ['اتاق1', 'اتاق2', 'انبار'];
        let responsiblePerson = localStorage.getItem('responsiblePerson') || '';
        let currentUser = localStorage.getItem('currentUser') || 'کاربر';
        let darkMode = localStorage.getItem('darkMode') === 'true';
        
        // Confirm modal variables
        let confirmCallback = null;
        let confirmData = null;
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Apply dark mode if enabled
            if (darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').textContent = '💡';
            } else {
                document.getElementById('darkModeToggle').textContent = '🌙';
            }
            
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Set welcome message with responsible person's name
            document.getElementById('welcomeMessage').textContent = `وقت بخیر ${responsiblePerson || currentUser}`;
            
            // Check if responsible person needs to be set
            if (!responsiblePerson) {
                document.getElementById('responsibleModal').style.display = 'block';
            } else {
                document.getElementById('asset-responsible').value = responsiblePerson;
            }
            
            // Load locations dropdown
            loadLocations();
            
            // Load assets table
            loadAssetsTable();
            
            // Load reports
            loadReports();
            
            // Show current responsible person
            document.getElementById('current-responsible').textContent = responsiblePerson || '-';
        });
        
        // Set initial responsible person
        function setInitialResponsible() {
            const responsible = document.getElementById('initial-responsible').value.trim();
            
            if (!responsible) {
                alert('لطفاً نام مسئول را وارد کنید');
                return;
            }
            
            responsiblePerson = responsible;
            localStorage.setItem('responsiblePerson', responsible);
            document.getElementById('asset-responsible').value = responsible;
            document.getElementById('current-responsible').textContent = responsible;
            document.getElementById('responsibleModal').style.display = 'none';
            
            // Update welcome message
            document.getElementById('welcomeMessage').textContent = `وقت بخیر ${responsible}`;
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            darkMode = !darkMode;
            localStorage.setItem('darkMode', darkMode);
            
            if (darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').textContent = '💡';
            } else {
                document.body.classList.remove('dark-mode');
                document.getElementById('darkModeToggle').textContent = '🌙';
            }
        }
        
        // Update date and time
        function updateDateTime() {
            const now = new Date();
            
            // Full date
            const dateOptions = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            };
            const persianDate = new Intl.DateTimeFormat('fa-IR', dateOptions).format(now);
            
            // Weekday
            const weekdayOptions = { weekday: 'long' };
            const persianWeekday = new Intl.DateTimeFormat('fa-IR', weekdayOptions).format(now);
            
            // Time
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit'
            };
            const persianTime = new Intl.DateTimeFormat('fa-IR', timeOptions).format(now);
            
            document.getElementById('dateTime').textContent = `${persianDate} - ${persianTime}`;
            document.getElementById('currentWeekday').textContent = `${persianWeekday}`;
        }
        
        // Show confirmation modal
        function showConfirm(title, message, callback, data = null) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').style.display = 'block';
            confirmCallback = callback;
            confirmData = data;
        }
        
        // Handle confirm action
        function confirmAction(confirmed) {
            document.getElementById('confirmModal').style.display = 'none';
            if (confirmed && confirmCallback) {
                if (confirmData !== null) {
                    confirmCallback(confirmData);
                } else {
                    confirmCallback();
                }
            }
        }
        
        // Show different sections
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.remove('hidden');
            event.currentTarget.classList.add('active');
            
            if (sectionId === 'view-assets') {
                loadAssetsTable();
            } else if (sectionId === 'reports') {
                loadReports();
            } else if (sectionId === 'manage-locations') {
                loadLocationsList();
            }
        }
        
        // Manage locations section
        function manageLocations() {
            showSection('manage-locations');
        }
        
        // Change responsible section
        function changeResponsible() {
            showSection('change-responsible');
        }
        
        // Load locations dropdown
        function loadLocations() {
            const locationSelect = document.getElementById('asset-location');
            locationSelect.innerHTML = '<option value="">انتخاب کنید</option>';
            
            locations.forEach(location => {
                const option = document.createElement('option');
                option.value = location;
                option.textContent = location;
                locationSelect.appendChild(option);
            });
        }
        
        // Add new asset
        function addAsset() {
            const assetName = document.getElementById('asset-name').value;
            const assetCode = document.getElementById('asset-code').value;
            const personName = document.getElementById('person-name').value;
            const personCode = document.getElementById('person-code').value;
            const assetLocation = document.getElementById('asset-location').value;
            const responsible = document.getElementById('asset-responsible').value;
            
            if (!assetName || !assetCode || !personName || !assetLocation || !responsible) {
                showError('addError', 'لطفاً تمام فیلدهای ضروری را پر کنید');
                return;
            }
            
            // Check if asset code already exists
            if (assets.some(asset => asset.code === assetCode)) {
                showError('addError', 'کد اموال تکراری است');
                return;
            }
            
            // Generate person code if not provided
            const finalPersonCode = personCode || generatePersonCode(personName);
            
            // Add new asset
            const now = new Date();
            const persianDate = new Intl.DateTimeFormat('fa-IR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            }).format(now);
            
            const newAsset = {
                name: assetName,
                code: assetCode,
                person: personName,
                personCode: finalPersonCode,
                location: assetLocation,
                responsible: responsible,
                date: persianDate,
                timestamp: now.getTime()
            };
            
            assets.push(newAsset);
            saveAssets();
            
            // Update person code field
            document.getElementById('person-code').value = finalPersonCode;
            
            showSuccess('addSuccess', 'اموال با موفقیت ثبت شد');
            clearForm();
            loadAssetsTable();
            loadReports();
        }
        
        // Generate person code
        function generatePersonCode(name) {
            const initials = name.split(' ').map(part => part[0]).join('').toUpperCase();
            const randomNum = Math.floor(100 + Math.random() * 900);
            return `${initials}${randomNum}`;
        }
        
        // Clear form
        function clearForm() {
            document.getElementById('asset-name').value = '';
            document.getElementById('asset-code').value = '';
            document.getElementById('person-name').value = '';
            document.getElementById('person-code').value = '';
            document.getElementById('asset-location').value = '';
            document.getElementById('addError').style.display = 'none';
        }
        
        // Save assets to localStorage
        function saveAssets() {
            localStorage.setItem('assets', JSON.stringify(assets));
        }
        
        // Save locations to localStorage
        function saveLocations() {
            localStorage.setItem('locations', JSON.stringify(locations));
        }
        
        // Load assets table
        function loadAssetsTable() {
            const tbody = document.getElementById('assets-list');
            tbody.innerHTML = '';
            
            assets.forEach((asset, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${asset.name}</td>
                    <td>${asset.code}</td>
                    <td>${asset.person}</td>
                    <td>${asset.personCode}</td>
                    <td>${asset.location}</td>
                    <td>${asset.responsible}</td>
                    <td>${asset.date}</td>
                    <td>
                        <div class="action-buttons-cell">
                            <button class="action-button edit-button" onclick="editAsset(${index})">
                                <svg class="action-icon" viewBox="0 0 24 24">
                                    <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" />
                                </svg>
                                ویرایش
                            </button>
                            <button class="action-button delete-button" onclick="showConfirm('حذف اموال', 'آیا از حذف این اموال مطمئن هستید؟', deleteAsset, ${index})">
                                <svg class="action-icon" viewBox="0 0 24 24">
                                    <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                                </svg>
                                حذف
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Edit asset
        function editAsset(index) {
            const asset = assets[index];
            
            document.getElementById('asset-name').value = asset.name;
            document.getElementById('asset-code').value = asset.code;
            document.getElementById('person-name').value = asset.person;
            document.getElementById('person-code').value = asset.personCode;
            document.getElementById('asset-location').value = asset.location;
            document.getElementById('asset-responsible').value = asset.responsible;
            
            showSection('add-asset');
            
            // Scroll to form
            document.getElementById('add-asset').scrollIntoView();
        }
        
        // Delete asset
        function deleteAsset(index) {
            assets.splice(index, 1);
            saveAssets();
            loadAssetsTable();
            loadReports();
            showSuccess('addSuccess', 'اموال با موفقیت حذف شد');
        }
        
        // Search assets
        function searchAssets() {
            const assetCode = document.getElementById('search-asset-code').value;
            const personName = document.getElementById('search-person-name').value;
            const personCode = document.getElementById('search-person-code').value;
            
            let results = assets;
            
            if (assetCode) {
                results = results.filter(asset => asset.code.includes(assetCode));
            }
            
            if (personName) {
                results = results.filter(asset => asset.person.includes(personName));
            }
            
            if (personCode) {
                results = results.filter(asset => asset.personCode.includes(personCode));
            }
            
            displaySearchResults(results);
        }
        
        // Display search results
        function displaySearchResults(results) {
            const tbody = document.getElementById('search-results');
            tbody.innerHTML = '';
            
            if (results.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="8" style="text-align: center;">نتیجه‌ای یافت نشد</td>`;
                tbody.appendChild(row);
                return;
            }
            
            results.forEach((asset, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${asset.name}</td>
                    <td>${asset.code}</td>
                    <td>${asset.person}</td>
                    <td>${asset.personCode}</td>
                    <td>${asset.location}</td>
                    <td>${asset.responsible}</td>
                    <td>${asset.date}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Clear search
        function clearSearch() {
            document.getElementById('search-asset-code').value = '';
            document.getElementById('search-person-name').value = '';
            document.getElementById('search-person-code').value = '';
            document.getElementById('search-results').innerHTML = '';
        }
        
        // Load reports
        function loadReports() {
            // Total assets
            document.getElementById('total-assets').textContent = assets.length;
            
            // Total locations
            document.getElementById('total-locations').textContent = locations.length;
            
            // Last update
            if (assets.length > 0) {
                const lastAsset = assets.reduce((latest, current) => 
                    current.timestamp > latest.timestamp ? current : latest
                );
                document.getElementById('last-update').textContent = lastAsset.date;
            } else {
                document.getElementById('last-update').textContent = '-';
            }
            
            // Location distribution
            const locationDistribution = {};
            locations.forEach(location => {
                locationDistribution[location] = 0;
            });
            
            assets.forEach(asset => {
                if (locationDistribution.hasOwnProperty(asset.location)) {
                    locationDistribution[asset.location]++;
                }
            });
            
            const tbody = document.getElementById('location-distribution-body');
            tbody.innerHTML = '';
            
            for (const location in locationDistribution) {
                const count = locationDistribution[location];
                const percentage = assets.length > 0 ? ((count / assets.length) * 100).toFixed(1) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${location}</td>
                    <td>${count}</td>
                    <td>${percentage}%</td>
                `;
                
                tbody.appendChild(row);
            }
        }
        
        // Add new location
        function addLocation() {
            const newLocation = document.getElementById('new-location').value.trim();
            
            if (!newLocation) {
                showError('locationError', 'لطفاً نام محل را وارد کنید');
                return;
            }
            
            if (locations.includes(newLocation)) {
                showError('locationError', 'این محل قبلاً ثبت شده است');
                return;
            }
            
            locations.push(newLocation);
            saveLocations();
            loadLocations();
            loadLocationsList();
            loadReports();
            
            document.getElementById('new-location').value = '';
            showSuccess('locationSuccess', 'محل استقرار جدید با موفقیت اضافه شد');
        }
        
        // Load locations list
        function loadLocationsList() {
            const tbody = document.getElementById('locations-list');
            tbody.innerHTML = '';
            
            // Count assets per location
            const locationCounts = {};
            locations.forEach(location => {
                locationCounts[location] = 0;
            });
            
            assets.forEach(asset => {
                if (locationCounts.hasOwnProperty(asset.location)) {
                    locationCounts[asset.location]++;
                }
            });
            
            locations.forEach((location, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${location}</td>
                    <td>${locationCounts[location] || 0}</td>
                    <td>
                        <button class="action-button delete-button" onclick="showConfirm('حذف محل', 'آیا از حذف محل "${location}" مطمئن هستید؟', deleteLocation, '${location}')">
                            <svg class="action-icon" viewBox="0 0 24 24">
                                <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                            </svg>
                            حذف
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Delete location
        function deleteLocation(location) {
            // Check if any asset is using this location
            const assetsInLocation = assets.filter(asset => asset.location === location);
            
            if (assetsInLocation.length > 0) {
                showError('locationError', `این محل در حال استفاده توسط ${assetsInLocation.length} اموال است و نمی‌توان حذف کرد`);
                return;
            }
            
            locations = locations.filter(loc => loc !== location);
            saveLocations();
            loadLocations();
            loadLocationsList();
            loadReports();
            showSuccess('locationSuccess', 'محل استقرار با موفقیت حذف شد');
        }
        
        // Change responsible person
        function changeResponsiblePerson() {
            const newResponsible = document.getElementById('new-responsible').value.trim();
            
            if (!newResponsible) {
                showError('responsibleError', 'لطفاً نام مسئول جدید را وارد کنید');
                return;
            }
            
            responsiblePerson = newResponsible;
            localStorage.setItem('responsiblePerson', responsiblePerson);
            
            // Update responsible in all assets
            assets.forEach(asset => {
                asset.responsible = newResponsible;
            });
            saveAssets();
            
            document.getElementById('asset-responsible').value = newResponsible;
            document.getElementById('current-responsible').textContent = newResponsible;
            
            // Update welcome message
            document.getElementById('welcomeMessage').textContent = `وقت بخیر ${newResponsible}`;
            
            showSuccess('responsibleSuccess', 'مسئول اموال با موفقیت تغییر کرد');
            document.getElementById('new-responsible').value = '';
        }
        
        // Export to Excel
        function exportToExcel() {
            if (assets.length === 0) {
                showError('addError', 'داده‌ای برای خروجی وجود ندارد');
                return;
            }
            
            // Prepare data
            const data = [
                ['نام کالا', 'کد اموال', 'نام فرد', 'کد فرد', 'محل استقرار', 'مسئول ثبت', 'تاریخ ثبت']
            ];
            
            assets.forEach(asset => {
                data.push([
                    asset.name,
                    asset.code,
                    asset.person,
                    asset.personCode,
                    asset.location,
                    asset.responsible,
                    asset.date
                ]);
            });
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, "اموال سازمان");
            
            // Generate file name with Persian date
            const now = new Date();
            const persianDate = new Intl.DateTimeFormat('fa-IR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            }).format(now);
            
            const fileName = `اموال_سازمان_${persianDate.replace(/[/,: ]/g, '_')}.xlsx`;
            
            // Export
            XLSX.writeFile(wb, fileName);
        }
        
        // Import from Excel
        function importFromExcel() {
            document.getElementById('excelFileInput').click();
        }
        
        // Handle file selection for Excel import
        document.getElementById('excelFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Get first sheet
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    // Check if the format is correct
                    if (jsonData.length < 2 || jsonData[0].length < 7) {
                        showError('addError', 'فرمت فایل اکسل صحیح نیست. لطفاً از فایل خروجی گرفته شده از سیستم استفاده کنید.');
                        return;
                    }
                    
                    // Parse data (skip header row)
                    const importedAssets = [];
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row.length < 7) continue;
                        
                        const now = new Date();
                        const persianDate = new Intl.DateTimeFormat('fa-IR', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        }).format(now);
                        
                        importedAssets.push({
                            name: row[0] || '',
                            code: row[1] || '',
                            person: row[2] || '',
                            personCode: row[3] || generatePersonCode(row[2] || ''),
                            location: row[4] || '',
                            responsible: row[5] || responsiblePerson,
                            date: row[6] || persianDate,
                            timestamp: now.getTime()
                        });
                    }
                    
                    if (importedAssets.length === 0) {
                        showError('addError', 'هیچ داده معتبری در فایل اکسل یافت نشد');
                        return;
                    }
                    
                    // Replace current assets with imported ones
                    assets = importedAssets;
                    saveAssets();
                    
                    // Update locations if new ones are found
                    const newLocations = [...locations];
                    importedAssets.forEach(asset => {
                        if (asset.location && !newLocations.includes(asset.location)) {
                            newLocations.push(asset.location);
                        }
                    });
                    
                    if (newLocations.length > locations.length) {
                        locations = newLocations;
                        saveLocations();
                        loadLocations();
                    }
                    
                    loadAssetsTable();
                    loadReports();
                    showSuccess('addSuccess', `${importedAssets.length} اموال با موفقیت از فایل اکسل وارد شدند`);
                    
                } catch (error) {
                    console.error('Error importing Excel:', error);
                    showError('addError', 'خطا در پردازش فایل اکسل. لطفاً از صحت فرمت فایل اطمینان حاصل کنید.');
                }
            };
            reader.readAsArrayBuffer(file);
            
            // Reset file input
            e.target.value = '';
        });
        
        // Show success message
        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
        
        // Show error message
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>